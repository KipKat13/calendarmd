<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A beautiful Catppuccin-themed webpage">
    <title>Markdown Calendar</title>
    <link rel="stylesheet" href="style.css">
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const columnInput = document.getElementById("column-input");
            const columnList = document.getElementById("column-list");
            const dataList = document.getElementById("data-list");
            const dataInputContainer = document.getElementById("data-input-container");
            const output = document.getElementById("output");

            let draggedItem = null;

            function addColumn() {
                const columnName = columnInput.value.trim();
                if (columnName === "") return;

                const listItem = createDraggableItem(columnName, columnList, updateMarkdownTable);
                columnList.appendChild(listItem);
                columnInput.value = "";

                updateDataInputs();
                updateMarkdownTable();
            }

            function createDraggableItem(text, parentList, onUpdate) {
                const listItem = document.createElement("li");
                listItem.className = "column-item";
                listItem.draggable = true;

                listItem.innerHTML = `
                    <span>${text}</span>
                    <button class="delete-button" onclick="this.parentElement.remove(); updateDataInputs(); ${onUpdate.name}();">Ã—</button>
                `;

                listItem.addEventListener("dragstart", () => {
                    draggedItem = listItem;
                    listItem.classList.add("dragging");
                });

                listItem.addEventListener("dragend", () => {
                    draggedItem = null;
                    listItem.classList.remove("dragging");
                    updateDataInputs();
                    onUpdate();
                });

                listItem.addEventListener("dragover", (e) => {
                    e.preventDefault();
                    const afterElement = getDragAfterElement(parentList, e.clientY);
                    if (afterElement == null) {
                        parentList.appendChild(draggedItem);
                    } else {
                        parentList.insertBefore(draggedItem, afterElement);
                    }
                });

                return listItem;
            }

            function getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll(".column-item:not(.dragging)")];

                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;
                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }

            function updateDataInputs() {
                const columns = Array.from(columnList.querySelectorAll(".column-item span")).map(
                    span => span.textContent
                );

                // Clear existing inputs
                dataInputContainer.innerHTML = "";

                if (columns.length === 0) {
                    const placeholder = document.createElement("p");
                    placeholder.textContent = "Please define columns first.";
                    dataInputContainer.appendChild(placeholder);
                    return;
                }

                // Add input fields matching columns
                columns.forEach(columnName => {
                    const inputField = document.createElement("input");
                    inputField.type = "text";
                    inputField.placeholder = columnName;
                    inputField.dataset.column = columnName;
                    dataInputContainer.appendChild(inputField);
                });

                // Add the add row button
                const addRowButton = document.createElement("button");
                addRowButton.type = "button";
                addRowButton.textContent = "Add Row";
                addRowButton.className = "cta-button";
                addRowButton.onclick = addDataRow;
                dataInputContainer.appendChild(addRowButton);
            }

            function addDataRow() {
                const inputs = Array.from(dataInputContainer.querySelectorAll("input"));
                const rowData = inputs.map(input => input.value.trim());

                if (rowData.some(value => value === "")) {
                    alert("Please fill out all fields before adding a row.");
                    return;
                }

                // Create draggable row item
                const listItem = document.createElement("li");
                listItem.className = "column-item";
                listItem.draggable = true;

                listItem.innerHTML = `
                    <span>${rowData.join(" | ")}</span>
                    <button class="delete-button" onclick="this.parentElement.remove(); updateMarkdownTable();">Ã—</button>
                `;

                listItem.addEventListener("dragstart", () => {
                    draggedItem = listItem;
                    listItem.classList.add("dragging");
                });

                listItem.addEventListener("dragend", () => {
                    draggedItem = null;
                    listItem.classList.remove("dragging");
                    updateMarkdownTable();
                });

                listItem.addEventListener("dragover", (e) => {
                    e.preventDefault();
                    const afterElement = getDragAfterElement(dataList, e.clientY);
                    if (afterElement == null) {
                        dataList.appendChild(draggedItem);
                    } else {
                        dataList.insertBefore(draggedItem, afterElement);
                    }
                });

                dataList.appendChild(listItem);

                // Clear inputs
                inputs.forEach(input => input.value = "");

                updateMarkdownTable();
            }

            function updateMarkdownTable() {
                const columns = Array.from(columnList.querySelectorAll(".column-item span")).map(
                    span => span.textContent
                );

                const rows = Array.from(dataList.querySelectorAll(".column-item span")).map(
                    span => span.textContent.split(" | ")
                );

                if (columns.length === 0) {
                    output.value = "Your markdown table will appear here...";
                    autoResizeTextarea(output);
                    return;
                }

                const headerRow = `| ${columns.join(" | ")} |`;
                const separatorRow = `| ${columns.map(() => "---").join(" | ")} |`;
                const dataRows = rows.map(row => `| ${row.join(" | ")} |`).join("\n");

                const markdownTable = `${headerRow}\n${separatorRow}\n${dataRows}`;
                output.value = markdownTable;

                autoResizeTextarea(output);
            }

            function autoResizeTextarea(textarea) {
                textarea.style.height = "auto";
                textarea.style.height = `${textarea.scrollHeight}px`;
            }

            columnInput.addEventListener("keypress", (e) => {
                if (e.key === "Enter") {
                    e.preventDefault();
                    addColumn();
                }
            });
        });
    </script>
</head>
<body>
    <header>
        <h1>Welcome to the Markdown Calendar Generator!</h1>
    </header>
    <main>
        <section>
            <h2>Define Your Columns</h2>
            <p>Enter a column name and press Enter. Drag and drop to rearrange columns:</p>
            <div>
                <input type="text" id="column-input" placeholder="e.g., Date" />
            </div>
            <ul id="column-list" class="column-list"></ul>
        </section>
        <section>
            <h2>Manage Your Data</h2>
            <p>Add data matching your columns. Drag and drop to rearrange rows:</p>
            <div id="data-input-container"></div>
            <ul id="data-list" class="column-list"></ul>
        </section>
        <section>
            <h3>Generated Markdown Table:</h3>
            <textarea id="output" rows="10" cols="50" readonly placeholder="Your markdown table will appear here..."></textarea>
        </section>
    </main>
    <footer>
        <a href="https://github.com/KipKat13" class="footer-link" target="_blank">Crafted with ðŸ’– by KipKat13!</a>
    </footer>
</body>
</html>